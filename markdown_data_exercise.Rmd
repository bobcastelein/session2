---
title: "Data Exercise 1"
author: "Bob Castelein"
date: "17-5-2017"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## The Netherlands' banana trade

One of the main cargoes shipped in reefer containers is bananas. They make up some 20% of all conditioned cargo, and impose some of the most stringent requirements on energy security, due to the narrow temperature bandwidth (2 degrees at most) at which the product should be preserved.

In this exercise, I will work with data of the Netherlands' import and export flows of bananas. From the FAO statistics website (http://www.fao.org/faostat/en/#home) I pull the trade matrix data for the Netherlands as the reporting country, selecting all partner countries, and bananas as the item, for the years 2000-2013. This raw data file is available for download at my github page.

First I download the data and store it in a variable called 'bananas'.

```{r}
bananas <- read.csv(file = "https://raw.githubusercontent.com/bobcastelein/session2/master/nlbananas2000-2013.csv")
head(bananas)
```

Right now, the data looks a bit messy, with several variables we don't need. We are interested in the partner country (the reporting country is always the Netherlands), the element (export quantity/value, and import quantity/value - although this distinction is not as useful when considering one commodity only), the year, and the value. To work with these variables alone, I use the dplyr package to select the appropriate variables.

```{r, message = FALSE}
library(dplyr)
invisible(bananasl <- bananas %>% select(Partner.Countries, Element, Year, Unit, Value))
head(bananasl)
```

The data is still in a long format (various rows per country per element, denoted by bananasl), so I transform it to a wide format. First I unite the element and unit columns into one variable called 'flow'.

```{r}
library(tidyr)
invisible(bananasl <- bananasl %>% unite(flow, Element, Unit, sep = "_"))
head(bananasl)
```

To transform it to a wide format, I 'spread' the flow and value variables, and rename the new variables to facilitate coding and reading.

```{r}
invisible(bananasw <- bananasl %>% spread(flow, Value))
invisible(bananasw <- bananasw %>% rename(exquant = `Export Quantity_tonnes`, exval = `Export Value_1000 US$`, imquant = `Import Quantity_tonnes`, imval = `Import Value_1000 US$`))
head(bananasw)
```

To compile a list of the most important banana import and export markets for the Netherlands, I create two new tibbles, listing the partner countries and their average annual banana flow.

```{r}
export_to <- bananasw %>% group_by(Partner.Countries) %>% summarise(mean(exval))
import_from <- bananasw %>% group_by(Partner.Countries) %>% summarise(mean(imval))
```

```{r}
export_to %>% arrange(desc(`mean(exval)`))
import_from %>% arrange(desc(`mean(imval)`))
```





