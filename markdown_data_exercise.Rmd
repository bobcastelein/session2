---
title: "Data Exercise 1"
author: "Bob Castelein"
date: "17-5-2017"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# The Netherlands' banana trade


## Introduction

One of the main cargoes shipped in reefer containers is bananas. They make up some 20% of all conditioned cargo, and impose some of the most stringent requirements on energy security, due to the narrow temperature bandwidth (2 degrees at most) at which the product should be preserved.


## Collecting the data

In this exercise, I will work with data of the Netherlands' import and export flows of bananas. From the FAO statistics website (http://www.fao.org/faostat/en/#home) I pull the trade matrix data for the Netherlands as the reporting country, selecting all partner countries, and bananas as the item, for the years 2000-2013. This raw data file is available for download at my github page.

First I download the data and store it in a variable called 'bananas'.

```{r}
bananas <- read.csv(file = "https://raw.githubusercontent.com/bobcastelein/session2/master/nlbananas2000-2013.csv")
head(bananas)
```


## Data cleaning

Right now, the data looks a bit messy, with several variables we don't need. We are interested in the partner country (the reporting country is always the Netherlands), the element (export quantity/value, and import quantity/value - although this distinction is not as useful when considering one commodity only), the year, and the value. To work with these variables alone, I use the dplyr package to select the appropriate variables.

```{r, message = FALSE}
library(dplyr)
invisible(bananasl <- bananas %>% select(Partner.Countries, Element, Year, Unit, Value))
head(bananasl)
```

The data is still in a long format (various rows per country per element, denoted by bananasl), so I transform it to a wide format. First I unite the element and unit columns into one variable called 'flow'.

```{r}
library(tidyr)
invisible(bananasl <- bananasl %>% unite(flow, Element, Unit, sep = "_"))
head(bananasl)
```

To transform it to a wide format, I 'spread' the flow and value variables, and rename the new variables to facilitate coding and reading.

```{r}
invisible(bananasw <- bananasl %>% spread(flow, Value))
invisible(bananasw <- bananasw %>% rename(exquant = `Export Quantity_tonnes`, exval = `Export Value_1000 US$`, imquant = `Import Quantity_tonnes`, imval = `Import Value_1000 US$`))
head(bananasw)
```


Subsequently I rank the countries according to mean import and export value over the period 2000-2013, and select the 10 most important import and export partners.

```{r}
head(bananasw %>% group_by(Partner.Countries) %>% summarize(mean(imval)) %>% arrange(desc(`mean(imval)`)), 10)
head(bananasw %>% group_by(Partner.Countries) %>% summarize(mean(exval)) %>% arrange(desc(`mean(exval)`)), 10)
```

For the banana trade between the Netherlands and these countries I want to plot the developments in import and export volumes, expressed in total import/export value. First I select only those rows that correspond with the countries in these top 10s.

```{r}
topexport <- bananasw %>% group_by(Partner.Countries) %>% mutate(mean(exval)) %>% filter(mean(exval) > 2182)
topimport <- bananasw %>% group_by(Partner.Countries) %>% mutate(mean(imval)) %>% filter(mean(imval) > 2504)
topimport
topexport
```

Now we have two data frames, one with the export data for the Netherlands' 10 most important banana export partners, and one with the import data for the Netherlands' 10 most important banana import partners.


## Visualization

```{r}
library(ggplot2)
ggplot(topimport, aes(x = Year, y = imval, colour = factor(Partner.Countries))) + geom_point() + geom_line()
```

```{r}
ggplot(topexport, aes(x = Year, y = exval, colour = factor(Partner.Countries))) + geom_point() + geom_line()
```

